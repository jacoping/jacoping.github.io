<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Prova CropperJS</title>


  <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.6/cropper.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.6/cropper.min.js"></script>

  <!--
LOAD FROM FILE:
https://www.cssscript.com/demo/easy-client-side-image-cropping-library-cropper-js/
-->

  <style>
    div.clear {
      cloar: both;
    }

    div {
      min-height: 10px;
    }

    div.cropper-container {
      max-width: 200px;
    }

    div.preview-container {
      position: relative;
      float: left;
    }

    img.cropper {
      display: block;
      max-width: 100%;
    }

    img.preview {
      height: 200px;
    }

    .mask {
      position: absolute;
      height: 100%;
      width: 35%;
      z-index: 2;
      bottom: 0px;
      background-color: grey;
    }

    #left-mask {
      left: 0px;
    }

    #right-mask {
      right: 0px;
    }

    #result_mobile_div {
      height: 300px;
      background-position: center;
    }
  </style>

</head>


<body>



  <h1>
    Strumento di supporto per il caricamento di immagini sui siti unifi.it (beta)
  </h1>
  <h2>
    OUTPUT ATTESO: 1920x654 px - minore di 300kb
  </h2>
  <p>
    <span id="info"> </span>
        </p>
          <p>
    <a href="#" id="download_link">DOWNLOAD</a>
  </p>

  <!-- Wrap the image or canvas element with a block element (container) -->
  <div class="cropper-container">
    <img class="cropper" id="image" src="sample.jpg">
  </div>

  <div class="clear">
    <h2> versione desktop </h2>
    <div class="preview-container">
    </div>
    <img class="preview" id="result"><br>
  </div>
  <div class="clear">

    <div class="clear">
      <h2> versione mobile </h2>
      <div class="preview-container">
        <img class="preview" id="result_mobile">
        <div class="mask" id="left-mask"></div>
        <div class="mask" id="right-mask"></div>
      </div>







      <script>

        const download = function(dataurl) {
          alert("3");
          let a = document.createElement("a");
          const source = document.querySelector('#result')
          a.href = source.src;
          a.click()
        }
        // import 'cropperjs/dist/cropper.css';

        const image = document.querySelector('#image')
        const preview = document.querySelector('#preview')
        const result = document.querySelector('#result')
        const result_mobile = document.querySelector('#result_mobile')
        const download_link = document.querySelector('#download_link')

        const cropper = new Cropper(image, {
          aspectRatio: 1920 / 654, // size of output image
          viewMode: 1, // restricts crop area to image area
          preview: preview,
          autoCropArea: 1,
          movable: false,
          zoomable: false,
          toggleDragModeOnDblclick: false,


          crop(event) {
            console.log(event.detail.width);
            console.log(event.detail.height);
            clearTimeout();
            setTimeout(doCrop, 500);
          },
        });

        const doCrop = function() {
          let data = cropper.getData()
          document.querySelector("#info").innerHTML = data.width + " " + data.height;
          let dataurl = cropper.getCroppedCanvas({
            maxWidth: 1920,

          }).toDataURL();
          // }).toBlob();
          result.src = dataurl;
          result_mobile.src = dataurl;
          // download_link.href = dataurl;

          download_link.addEventListener("click", download);
        }
      </script>

</body>

</html>
